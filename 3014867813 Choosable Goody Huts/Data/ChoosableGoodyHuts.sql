-- ChoosableGoodyHuts
-- Author: Konomi
-- DateCreated: 7/28/2023 22:22:51
--------------------------------------------------------------

CREATE TABLE "GoodyHutSubTypes_Choose" (
		"GoodyHut" TEXT NOT NULL,
		"SubTypeGoodyHut" TEXT NOT NULL UNIQUE,
		"Description" TEXT,
		"Weight" INTEGER NOT NULL,
		"ModifierID" TEXT NOT NULL,
		"UpgradeUnit" BOOLEAN NOT NULL CHECK (UpgradeUnit IN (0,1)) DEFAULT 0,
		"Turn" INTEGER NOT NULL DEFAULT 0,
		"Experience" BOOLEAN NOT NULL CHECK (Experience IN (0,1)) DEFAULT 0,
		"Heal" INTEGER NOT NULL DEFAULT 0,
		"Relic" BOOLEAN NOT NULL CHECK (Relic IN (0,1)) DEFAULT 0,
		"Trader" BOOLEAN NOT NULL CHECK (Trader IN (0,1)) DEFAULT 0,
		"MinOneCity" BOOLEAN NOT NULL CHECK (MinOneCity IN (0,1)) DEFAULT 0,
		"RequiresUnit" BOOLEAN NOT NULL CHECK (RequiresUnit IN (0,1)) DEFAULT 0,
		PRIMARY KEY(SubTypeGoodyHut),
		FOREIGN KEY (GoodyHut) REFERENCES GoodyHuts(GoodyHutType) ON DELETE CASCADE ON UPDATE CASCADE);


INSERT INTO GoodyHutSubTypes_Choose
SELECT * FROM GoodyHutSubTypes WHERE GoodyHut NOT IN ('METEOR_GOODIES', 'GOODYHUT_SAILOR_WONDROUS') AND Weight > 0;

--UPDATE GoodyHutSubTypes SET Weight = 0 WHERE GoodyHut != 'METEOR_GOODIES';
UPDATE GoodyHutSubTypes SET Description = NULL WHERE GoodyHut NOT IN ('METEOR_GOODIES', 'GOODYHUT_SAILOR_WONDROUS') AND Weight > 0;

INSERT INTO Modifiers 
		(ModifierId, ModifierType, RunOnce, Permanent, SubjectRequirementSetId) 
SELECT ModifierID||'_AI', ModifierType, RunOnce, Permanent, 'PLAYER_IS_AI'
FROM Modifiers
WHERE EXISTS (
	SELECT ModifierId 
	FROM GoodyHutSubTypes 
	WHERE Modifiers.ModifierId = GoodyHutSubTypes.ModifierId AND GoodyHutSubTypes.GoodyHut NOT IN ('METEOR_GOODIES', 'GOODYHUT_SAILOR_WONDROUS') AND GoodyHutSubTypes.Weight > 0);

INSERT INTO ModifierArguments 
		(ModifierId, Name, Type, Value) 
SELECT ModifierID||'_AI', Name, Type, Value
FROM ModifierArguments
WHERE EXISTS (
	SELECT ModifierId 
	FROM GoodyHutSubTypes 
	WHERE ModifierArguments.ModifierId = GoodyHutSubTypes.ModifierId AND GoodyHutSubTypes.GoodyHut NOT IN ('METEOR_GOODIES', 'GOODYHUT_SAILOR_WONDROUS') AND GoodyHutSubTypes.Weight > 0);

UPDATE GoodyHutSubTypes 
SET ModifierID = ModifierID||'_AI'
WHERE GoodyHut NOT IN ('METEOR_GOODIES', 'GOODYHUT_SAILOR_WONDROUS') AND Weight > 0;

INSERT INTO Types 
		(Type,													Kind)
VALUES 	('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SCOUT',				'KIND_ABILITY'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_EXPERIENCE',		'KIND_ABILITY'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_HEAL',					'KIND_ABILITY'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_ADD_POP',					'KIND_ABILITY'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_BUILDER',			'KIND_ABILITY'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_TRADER',			'KIND_ABILITY'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SETTLER',			'KIND_ABILITY'),
		--('GOODYHUT_KNM_DUMMY',									'KIND_GOODY_HUT'),
		('NOTIFICATION_KNM_CHOOSE_GOODYHUT',					'KIND_NOTIFICATION');

--INSERT INTO GoodyHuts
		--(GoodyHutType,				ImprovementType,				Weight,		ShowMoment)
--VALUES 	('GOODYHUT_KNM_DUMMY',		'IMPROVEMENT_GOODY_HUT',		100,		1);
--
--INSERT INTO GoodyHutSubTypes
		--(GoodyHut,					SubTypeGoodyHut,			Description,	Weight,		ModifierID)
--VALUES 	('GOODYHUT_KNM_DUMMY',		'GOODYHUT_KNM_DUMMY',		NULL,			100,		'MODIFIER_KNM_CHOOSE_GOODYHUT');

INSERT INTO UnitAbilities
		(UnitAbilityType,										Name,		Description,		Inactive) 
VALUES	('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SCOUT',				NULL,		NULL,				1),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_EXPERIENCE',		NULL,		NULL,				1),
		('ABILITY_KNM_CHOOSE_GOODYHUT_HEAL',					NULL,		NULL,				1),
		('ABILITY_KNM_CHOOSE_GOODYHUT_ADD_POP',					NULL,		NULL,				1),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_BUILDER',			NULL,		NULL,				1),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_TRADER',			NULL,		NULL,				1),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SETTLER',			NULL,		NULL,				1);

INSERT INTO TypeTags 
		(Type,													Tag) 
VALUES	('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SCOUT',				'CLASS_ALL_UNITS'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_EXPERIENCE',		'CLASS_ALL_UNITS'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_HEAL',					'CLASS_ALL_UNITS'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_ADD_POP',					'CLASS_ALL_UNITS'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_BUILDER',			'CLASS_ALL_UNITS'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_TRADER',			'CLASS_ALL_UNITS'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SETTLER',			'CLASS_ALL_UNITS');

INSERT INTO UnitAbilityModifiers 
		(UnitAbilityType,										ModifierId) 
VALUES	('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SCOUT',				'GOODY_MILITARY_GRANT_SCOUT'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_EXPERIENCE',		'GOODY_MILITARY_GRANT_EXPERIENCE'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_HEAL',					'GOODY_MILITARY_HEAL'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_ADD_POP',					'GOODY_SURVIVORS_ADD_POPULATION'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_BUILDER',			'GOODY_SURVIVORS_GRANT_BUILDER'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_TRADER',			'GOODY_SURVIVORS_GRANT_TRADER'),
		('ABILITY_KNM_CHOOSE_GOODYHUT_GRANT_SETTLER',			'GOODY_SURVIVORS_GRANT_SETTLER');

--INSERT INTO Modifiers 
		--(ModifierId,						ModifierType,						RunOnce,	Permanent) 
--VALUES	('MODIFIER_KNM_CHOOSE_GOODYHUT',	'MODIFIER_ALLIANCE_DO_NOTHING',		1,			1);
--
INSERT INTO Notifications
		(NotificationType,							SeverityType,	ExpiresEndOfTurn,	AutoNotify, AutoActivate,	Message,									Summary)
VALUES	('NOTIFICATION_KNM_CHOOSE_GOODYHUT',		'MID',			1,					0,			1,				'LOC_KNM_CHOOSE_GOODYHUT_TITLE',			'LOC_KNM_CHOOSE_GOODYHUT_DESC');
